#define _CRT_SECURE_NO_WARNINGS 1


#include <stdint.h>
#include <stdio.h>
#include <ctype.h>
#include <memory.h>
#include <stdlib.h>
#include <string.h>

const char* filetype;
uint8_t first8hex[8];
uint8_t mp4_header[8] = { 0x00, 0x00, 0x00, 0x18, 0x66, 0x74, 0x79, 0x70 };
uint8_t png_header[8] = { 0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A };
uint8_t docx_pptx_xlsx_header[8] = { 0x50, 0x4B, 0x03, 0x04, 0x14, 0x00, 0x06, 0x00 };
uint8_t doc_header[6] = { 0x31, 0xBE, 0x00, 0x00, 0x00, 0xAB};
uint8_t ppt_header[4] = { 0x0F, 0x00, 0xE8, 0x03};
uint8_t pdf_header[4] = { 0x25, 0x50, 0x44, 0x46 };





void binary2hex_print(char* filename, char* buf)
{
    int i = 0, j = 0;
    unsigned char* p1 = (unsigned char*)buf;
    unsigned char* p2 = (unsigned char*)buf;
     

    for (i = 0; i < 8; i++)
    {
        first8hex[i] = (unsigned int)*(p1 + i);
    }
    
    for (int i = 0; i < 8; i++)
    {
        printf("%02x ", first8hex[i]);

    }
      
}

const char* GetFileExtenstion(const char* file_name)
{
    int file_name_len = strlen(file_name);
    file_name += file_name_len;

    const char* file_ext=NULL;
    for (int i = 0; i < file_name_len; i++)
    {
        if (*file_name == '.')
        {
            file_ext = file_name + 1;
            break;
        }
        file_name--;
    }
    return file_ext;
}


void fileheaderhexcheck()
{
    for(int i=0;i<8;i++)
        if (mp4_header[i] == first8hex[i])
        {
            filetype = "mp4";
        }
        else if (docx_pptx_xlsx_header[i] == first8hex[i])
        {
            filetype = "microsoftofficeexe";
        }
        else if (png_header[i] == first8hex[i])
        {
            filetype = "png";
        }
        else
        {
            filetype = "error";

        }

    for (int i = 0; i < 6; i++)
        if (doc_header[i] == first8hex[i])
        {
            filetype = "doc";
        }
        else
        {
            filetype = "error";

        }


    for (int i = 0; i < 4; i++)
        if (ppt_header[i] == first8hex[i])
        {
            filetype = "ppt";
        }
        else if (pdf_header[i] == first8hex[i])
        {
            filetype = "pdf";
        }
        else
        {
            filetype = "error";
        }



}


int main()
{
    FILE* fp = NULL;
    int size = 0;
    char* read_buf = NULL;
    const char* test = "C:\\Users\\user\\Documents\\test.txt";
    fp = fopen(test, "rb"); //바이너리 읽기 모드
    if (fp == NULL)
    {
        printf("open error\n");
        return 1;
    }

    fseek(fp, 0, SEEK_END);
    size = ftell(fp);
    fseek(fp, 0, SEEK_SET);

    int buf_size = size + 1;
    if (buf_size < 8) buf_size = 8;
    read_buf = (char*)calloc(buf_size, sizeof(char));
    if (read_buf == NULL) { printf("calloc error\n"); return 1; }
    fread(read_buf, sizeof(char), size, fp);
    fclose(fp);

    fileheaderhexcheck();
    const char* file_ext = GetFileExtenstion(test);
    if (strcmp(filetype, "error") == 0 && strcmp(file_ext, "txt") == 0)
    {
        filetype = "txt";
    }
 
  

    //바이너리 파일 화면 출력
    binary2hex_print((char*)test, read_buf);
    printf("%s", filetype);
  
    
  

    return 0;
}
